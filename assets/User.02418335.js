import{d as te,eH as E,r as _,b as ae,eL as g,e$ as oe,a as L,f as h,g as e,eK as t,eY as w,h as B,u as j,eW as D,e as d,f0 as se,o as n,eS as M,eT as T,y as i,f1 as re,eM as de}from"./index.d3ea056f.js";const ne={class:"user-manage"},ie={class:"query-form"},pe=i("\u67E5\u8BE2"),me=i("\u91CD\u7F6E"),ce={class:"base-table"},_e={class:"action"},be=i("\u65B0\u589E"),fe=i("\u6279\u91CF\u5220\u9664"),Fe=i("\u7F16\u8F91"),ge=i("\u5220\u9664"),Be=i("@imooc.com"),ve={class:"dialog-footer"},Ee=i("\u53D6 \u6D88"),De=i("\u786E \u5B9A"),he=te({__name:"User",setup(Ve){const p=E({state:1,userId:"",userName:""}),U=_([]),b=E({pageNum:1,pageSize:10}),y=_([]),f=_(!1),s=E({state:3,userId:0,userName:"",userEmail:"",mobile:"",job:"",roleList:[],deptId:""}),A=_([]),S=_([]),v=_("add"),q=E({userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",trigger:"blur"}],userEmail:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"blur"}],mobile:[{pattern:/1[3-9]\d{9}/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u683C\u5F0F",trigger:"blur"}],deptId:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"blur"}]}),R=E([{label:"\u7528\u6237ID",prop:"userId"},{label:"\u7528\u6237\u540D",prop:"userName"},{label:"\u7528\u6237\u90AE\u7BB1",prop:"userEmail"},{label:"\u7528\u6237\u89D2\u8272",prop:"role",formatter(a,u,o){return{0:"\u7BA1\u7406\u5458",1:"\u666E\u901A\u7528\u6237"}[o]}},{label:"\u7528\u6237\u72B6\u6001",prop:"state",formatter(a,u,o){return{1:"\u5728\u804C",2:"\u79BB\u804C",3:"\u8BD5\u7528\u671F"}[o]}},{label:"\u6CE8\u518C\u65F6\u95F4",prop:"createTime",width:180,formatter:(a,u,o)=>j.formateDate(new Date(o))},{label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4",prop:"lastLoginTime",width:180,formatter:(a,u,o)=>j.formateDate(new Date(o))}]);ae(()=>{F(),Q(),W()});const F=async()=>{let a={...p,...b};try{const{list:u,page:o}=await g.getUserList(a);U.value=u,b.total=o.total}catch{}},$=()=>{F()},x=_(),k=a=>{a&&a.resetFields()};oe(()=>b.pageNum,()=>{F()});const H=async a=>{await g.userDel({userIds:[a.userId]}),D.success("\u5220\u9664\u6210\u529F"),F()},K=async()=>{if(y.value.length==0){D.error("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u7528\u6237");return}(await g.userDel({userIds:y.value})).nModified>0?(D.success("\u5220\u9664\u6210\u529F"),F()):D.success("\u4FEE\u6539\u5931\u8D25")},O=a=>{let u=[];a.map(o=>{u.push(o.userId)}),y.value=u},P=()=>{v.value="add",f.value=!0},Q=async()=>{let a=await g.getDeptList();S.value=a},W=async()=>{let a=await g.getRoleAllList();A.value=a},V=_(),Y=()=>{f.value=!1,k(V.value)},G=()=>{var a;(a=V.value)==null||a.validate(async u=>{if(u){let o=re(s);o.userEmail+="@imooc.com",o.action=v.value,await g.userSubmit(o),f.value=!1,D.success("\u7528\u6237\u521B\u5EFA\u6210\u529F"),k(V.value),F()}})},J=a=>{v.value="edit",f.value=!0,de(()=>{Object.assign(s,a)})};return(a,u)=>{const o=d("el-input"),r=d("el-form-item"),m=d("el-option"),N=d("el-select"),c=d("el-button"),z=d("el-form"),I=d("el-table-column"),X=d("el-table"),Z=d("el-pagination"),ee=d("el-cascader"),ue=d("el-dialog"),C=se("has");return n(),L("div",ne,[h("div",ie,[e(z,{ref_key:"form",ref:x,inline:!0,model:p},{default:t(()=>[e(r,{label:"\u7528\u6237ID",prop:"userId"},{default:t(()=>[e(o,{modelValue:p.userId,"onUpdate:modelValue":u[0]||(u[0]=l=>p.userId=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237ID"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u7528\u6237\u540D\u79F0",prop:"userName"},{default:t(()=>[e(o,{modelValue:p.userName,"onUpdate:modelValue":u[1]||(u[1]=l=>p.userName=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u72B6\u6001",prop:"state"},{default:t(()=>[e(N,{modelValue:p.state,"onUpdate:modelValue":u[2]||(u[2]=l=>p.state=l)},{default:t(()=>[e(m,{value:0,label:"\u6240\u6709"}),e(m,{value:1,label:"\u5728\u804C"}),e(m,{value:2,label:"\u79BB\u804C"}),e(m,{value:3,label:"\u8BD5\u7528\u671F"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(c,{type:"primary",onClick:$},{default:t(()=>[pe]),_:1}),e(c,{onClick:u[3]||(u[3]=l=>k(x.value))},{default:t(()=>[me]),_:1})]),_:1})]),_:1},8,["model"])]),h("div",ce,[h("div",_e,[w((n(),B(c,{type:"primary",onClick:P},{default:t(()=>[be]),_:1})),[[C,"user-create"]]),w((n(),B(c,{type:"danger",onClick:K},{default:t(()=>[fe]),_:1})),[[C,"user-patch-delete"]])]),e(X,{data:U.value,onSelectionChange:O},{default:t(()=>[e(I,{type:"selection",width:"55"}),(n(!0),L(M,null,T(R,l=>(n(),B(I,{key:l.prop,prop:l.prop,label:l.label,width:l.width,formatter:l.formatter},null,8,["prop","label","width","formatter"]))),128)),e(I,{label:"\u64CD\u4F5C",width:"150"},{default:t(l=>[w((n(),B(c,{onClick:le=>J(l.row),size:"small"},{default:t(()=>[Fe]),_:2},1032,["onClick"])),[[C,"user-edit"]]),w((n(),B(c,{type:"danger",size:"small",onClick:le=>H(l.row)},{default:t(()=>[ge]),_:2},1032,["onClick"])),[[C,"user-delete"]])]),_:1})]),_:1},8,["data"]),e(Z,{class:"pagination",background:"",layout:"prev, pager, next",total:b.total,"page-size":b.pageSize,"current-page":b.pageNum,"onUpdate:current-page":u[4]||(u[4]=l=>b.pageNum=l)},null,8,["total","page-size","current-page"])]),e(ue,{title:"\u7528\u6237\u65B0\u589E",modelValue:f.value,"onUpdate:modelValue":u[12]||(u[12]=l=>f.value=l)},{footer:t(()=>[h("span",ve,[e(c,{onClick:Y},{default:t(()=>[Ee]),_:1}),e(c,{type:"primary",onClick:G},{default:t(()=>[De]),_:1})])]),default:t(()=>[e(z,{ref_key:"dialogForm",ref:V,model:s,"label-width":"100px",rules:q},{default:t(()=>[e(r,{label:"\u7528\u6237\u540D",prop:"userName"},{default:t(()=>[e(o,{modelValue:s.userName,"onUpdate:modelValue":u[5]||(u[5]=l=>s.userName=l),disabled:v.value=="edit",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},null,8,["modelValue","disabled"])]),_:1}),e(r,{label:"\u90AE\u7BB1",prop:"userEmail"},{default:t(()=>[e(o,{modelValue:s.userEmail,"onUpdate:modelValue":u[6]||(u[6]=l=>s.userEmail=l),disabled:v.value=="edit",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1"},{append:t(()=>[Be]),_:1},8,["modelValue","disabled"])]),_:1}),e(r,{label:"\u624B\u673A\u53F7",prop:"mobile"},{default:t(()=>[e(o,{modelValue:s.mobile,"onUpdate:modelValue":u[7]||(u[7]=l=>s.mobile=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u5C97\u4F4D",prop:"job"},{default:t(()=>[e(o,{modelValue:s.job,"onUpdate:modelValue":u[8]||(u[8]=l=>s.job=l),placeholder:"\u8BF7\u8F93\u5165\u5C97\u4F4D"},null,8,["modelValue"])]),_:1}),e(r,{label:"\u72B6\u6001",prop:"state"},{default:t(()=>[e(N,{modelValue:s.state,"onUpdate:modelValue":u[9]||(u[9]=l=>s.state=l)},{default:t(()=>[e(m,{value:1,label:"\u5728\u804C"}),e(m,{value:2,label:"\u79BB\u804C"}),e(m,{value:3,label:"\u8BD5\u7528\u671F"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"\u7CFB\u7EDF\u89D2\u8272",prop:"roleList"},{default:t(()=>[e(N,{modelValue:s.roleList,"onUpdate:modelValue":u[10]||(u[10]=l=>s.roleList=l),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u7CFB\u7EDF\u89D2\u8272",multiple:"",style:{width:"100%"}},{default:t(()=>[(n(!0),L(M,null,T(A.value,l=>(n(),B(m,{key:l.id,label:l.roleName,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"\u90E8\u95E8",prop:"deptId"},{default:t(()=>[e(ee,{modelValue:s.deptId,"onUpdate:modelValue":u[11]||(u[11]=l=>s.deptId=l),placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u90E8\u95E8",options:S.value,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{he as default};
